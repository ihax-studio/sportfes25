<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>翻訳</title>
<link rel="stylesheet" href="tr.css">
</head>
<body>
  <!-- 背景ぼかし -->
  <div class="fade-blue"></div>
  <!-- メインUI -->
  <div class="center-container">
    <div class="mic-wrapper" id="wrapper">
      <div id="mic" class="mic"></div>
    </div>
    <div id="jp">
      <input id="inputText" type="text" placeholder="ここに入力…" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" name="no_save" />
    </div>
    <div id="en"></div>
    <div class="close-button" id="closeBtn" title="Close"></div>
  </div>
  <script>
    // 閉じるボタンの処理
    document.getElementById('closeBtn').addEventListener('click', () => {
      // 全要素をslide-down
      document.getElementById('wrapper').classList.add('slide-down');
      document.getElementById('jp').classList.add('slide-down');
      document.getElementById('en').classList.add('slide-down');
      document.getElementById('closeBtn').classList.add('slide-down');
      setTimeout(() => {
        location.href = 'en.html';
      }, 510); // アニメ後に遷移
    });

    // micの拡大アニメーション
    window.addEventListener("DOMContentLoaded", () => {
      const mic = document.getElementById("mic");
      mic.style.transform = "scale(0.5)";
      mic.style.transition = "transform 0.7s cubic-bezier(.6,1.6,.2,1)";
      setTimeout(() => {
        mic.style.transform = "scale(1)";
      }, 80); // slight delay for effect
    });
</script>
  <script>
    const micEl = document.getElementById("mic");
    const wrapperEl = document.getElementById("wrapper");
    const jpEl = document.getElementById("jp");
    const enEl = document.getElementById("en");
    const inputEl = document.getElementById("inputText");
  
    let isJpToEn = true;
    let enterCount = 0;
  
    async function translate(text) {
  if (!text) return "";
  const from = isJpToEn ? "ja" : "en";
  const to = isJpToEn ? "en" : "ja";
  const res = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${from}|${to}&rand=${Date.now()}`);
  const data = await res.json();
  return data.responseData.translatedText || "";
}

    inputEl.addEventListener("input", async () => {
      enterCount = 0; // 🔁 Enterカウントリセット
      const text = inputEl.value;
      const translated = await translate(text);
      enEl.textContent = translated;
  
      enEl.classList.remove("show");
      void enEl.offsetWidth;
      enEl.classList.add("show");
  
      micEl.classList.remove("pulse");
      void micEl.offsetWidth;
      micEl.classList.add("pulse");
    });
  
    function triggerSlideUp(el) {
      el.classList.remove("slide-up");
      void el.offsetWidth;
      el.classList.add("slide-up");
    }
  
    function swapDirection() {
      isJpToEn = !isJpToEn;
  
      if (isJpToEn) {
        jpEl.style.bottom = "30px";
        jpEl.style.top = "";
        enEl.style.top = "30px";
        enEl.style.bottom = "";
        enEl.style.transform = "rotate(180deg)";
        inputEl.placeholder = "ここに入力…";
      } else {
        jpEl.style.bottom = "";
        jpEl.style.top = "30px";
        enEl.style.top = "";
        enEl.style.bottom = "30px";
        enEl.style.transform = "rotate(0deg)";
        inputEl.placeholder = "Type here...";
      }
  
      resetAll();
      triggerSlideUp(jpEl);
    }
  
    // 🧹 全データをクリア
    function resetAll() {
      inputEl.value = "";
      enEl.textContent = "";
      enEl.classList.remove("show");
      enterCount = 0;
      inputEl.focus();
    }
  
    // 🧠 Micクリックでリセット
    wrapperEl.addEventListener("click", () => {
      resetAll();
      micEl.classList.remove("pulse");
      void micEl.offsetWidth;
      micEl.classList.add("pulse");
    });
  
    // 💣 Enter2回目でリセット
    inputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        enterCount++;
  
        const input = inputEl.value.trim().toLowerCase();
  
        // 言語切り替えコマンド
        if (isJpToEn && (input === "english" || input === "change to english" || input === "us" || input === "eigo")) {
          swapDirection();
          return;
        }
        if (!isJpToEn && (input.includes("日本語") || input.includes("日本") || input.includes("かな") || input.includes("あ") || input.includes("にほん"))) {
          swapDirection();
          return;
        }
  
        // 2回目のEnterで全削除
        if (enterCount >= 2) {
          resetAll();
        }
      }
    });
    window.addEventListener("load", () => {
  // 🚫 自動復元対策
  inputEl.value = "";
  enEl.textContent = "";
  enEl.classList.remove("show");
});
window.addEventListener('DOMContentLoaded', () => {
  setTimeout(() => {
    document.body.classList.add('faded');
  }, 550); // ←ここ好きな秒数で
});


function adjustUiSizes() {
  const w = window.innerWidth;
  const h = window.innerHeight;
  const shortEdge = Math.min(w, h);

  // --- マイク（白丸） ---
  const micSize = Math.max(120, shortEdge * 0.53);
  const mic = document.getElementById('mic');
  if (mic) {
    mic.style.width = micSize + 'px';
    mic.style.height = micSize + 'px';
  }
  // --- マイクラッパー（中央に） ---
  const wrapper = document.getElementById('wrapper');
  if (wrapper) {
    wrapper.style.width = micSize + 'px';
    wrapper.style.height = micSize + 'px';
    wrapper.style.position = 'absolute';
    wrapper.style.top = '50%';
    wrapper.style.left = '50%';
    wrapper.style.transform = 'translate(-50%, -50%)';
    wrapper.style.display = 'flex';
    wrapper.style.alignItems = 'center';
    wrapper.style.justifyContent = 'center';
  }

  // --- 入力欄・翻訳欄（文字サイズ&幅） ---
  const jp = document.getElementById('jp');
  const en = document.getElementById('en');
  const textWidth = Math.max(300, shortEdge * 0.92); // 最大幅
  const fontSize = Math.max(52, Math.min(70, shortEdge * 0.85));
  if (jp) {
    jp.style.fontSize = fontSize + 'px';
    jp.style.width = textWidth + 'px';
    jp.style.left = (w - textWidth) * 0.5 + 'px';
    jp.style.right = '';
  }
  if (en) {
    en.style.fontSize = (fontSize * 1.1) + 'px';
    en.style.width = textWidth + 'px';
    en.style.right = (w - textWidth) * 0.5 + 'px';
    en.style.left = '';
  }

  // --- バツボタン（絶対下中央・サイズのみ調整） ---
  const closeBtn = document.getElementById('closeBtn');
  const closeSize = Math.max(46, Math.min(66, shortEdge * 0.13));
  if (closeBtn) {
    closeBtn.style.width = closeSize + 'px';
    closeBtn.style.height = closeSize + 'px';
    closeBtn.style.fontSize = (closeSize * 0.55) + 'px';
    // 位置はCSS（position:fixed; left:50%; bottom:●px; transform:translateX(-50%)）で制御！
  }
}

// 初回＆ウィンドウサイズ変更時に実行
window.addEventListener('DOMContentLoaded', adjustUiSizes);
window.addEventListener('resize', adjustUiSizes);
window.addEventListener('orientationchange', adjustUiSizes);


  </script>
  
</body>
</html>
